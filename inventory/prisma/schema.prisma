// prisma/schema.prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"] // Opcional para features adicionales
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum EstadoAlmacen {
  ACTIVO
  MANTENIMIENTO
  INACTIVO
}

enum Tipo {
  ENTRADA
  SALIDA
}

model Proveedor {
  id                String              @id
  name              String?
  ProveedorProducto ProveedorProducto[]
}

model Producto {
  id_producto            String               @id
  nombre_producto        String
  categoria              Categoria            @relation(fields: [categoria_id], references: [id])
  categoria_id           String
  descripcion            String
  sku                    String
  codigo_barras          String
  precio_unitario        Float
  peso_kg                Float
  dimensiones_cm         Float
  es_fragil              Boolean
  requiere_refrigeracion Boolean
  status                 Boolean
  ProveedorProducto      ProveedorProducto[]
  AlmacenProducto        AlmacenProducto[]
  Movement_Inventory     Movement_Inventory[]
}

model Categoria {
  id          String     @id @unique @default(uuid())
  name        String
  description String?
  Producto    Producto[]
}

model ProveedorProducto {
  id           String @id @default(uuid())
  id_producto  String
  id_proveedor String

  producto  Producto  @relation(fields: [id_producto], references: [id_producto])
  proveedor Proveedor @relation(fields: [id_proveedor], references: [id])

  @@unique([id_producto, id_proveedor])
}

model Almacen {
  id_almacen         String               @id
  nombre_almacen     String
  direccionId        String               @unique // Clave foránea para Address
  direccion          Direccion            @relation(fields: [direccionId], references: [id])
  gerente            String
  gerenteId          String? // Opcional: si quieres almacenar el ID del usuario del microservicio de usuarios
  capacidad_m3       Int
  capacidad_usada_m3 Int
  estado             EstadoAlmacen
  AlmacenProducto    AlmacenProducto[]
  Movement_Inventory Movement_Inventory[]
}

model Direccion {
  id        String   @id @default(uuid())
  calle     String // calle, avenida, etc.
  ciudadId  String
  ciudad    Ciudad   @relation(fields: [ciudadId], references: [id])
  latitud   Float
  longitud  Float
  almacen   Almacen? // Relación uno a uno con Almacen
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Ciudad {
  id             String       @id @unique @default(uuid())
  nombre         String
  codigo_postal  String // Código postal específico de esta dirección
  departamentoId String
  departamento   Departamento @relation(fields: [departamentoId], references: [id])
  direcciones    Direccion[]

  @@unique([nombre, departamentoId])
}

model Departamento {
  id       String   @id @unique @default(uuid())
  nombre   String
  pais     String
  ciudades Ciudad[]
}

model AlmacenProducto {
  id                String   @id
  id_producto       String
  id_almacen        String
  cantidad_stock    Int
  nivel_reorden     Int
  ultima_reposicion DateTime
  fecha_vencimiento DateTime

  producto Producto @relation(fields: [id_producto], references: [id_producto])
  almacen  Almacen  @relation(fields: [id_almacen], references: [id_almacen])

  @@unique([id_producto, id_almacen])
}

model Movement_Inventory {
  id          String   @id
  id_producto String
  id_almacen  String
  tipo        Tipo     @default(ENTRADA)
  cantidad    Int
  fecha       DateTime

  producto Producto @relation(fields: [id_producto], references: [id_producto])
  almacen  Almacen  @relation(fields: [id_almacen], references: [id_almacen])

  @@unique([id_producto, id_almacen, fecha])
}
